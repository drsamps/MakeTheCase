# MakeTheCase Apache Configuration
# This file is included within an existing VirtualHost context
# Ensure proxy modules are enabled: sudo a2enmod proxy proxy_http

# Enable proxy modules
ProxyPreserveHost On
ProxyRequests Off

# Proxy API requests to Node.js backend
# The backend expects /api routes, so we pass them through
ProxyPass /makethecase/api http://localhost:3001/api
ProxyPassReverse /makethecase/api http://localhost:3001/api

# Proxy all other /makethecase requests to Node.js for client-side routing
# The Node.js server will serve static files and handle SPA routing
ProxyPass /makethecase http://localhost:3001/makethecase
ProxyPassReverse /makethecase http://localhost:3001/makethecase

# Optional: Serve static files directly from Apache instead of Node.js
# Uncomment the following lines if you prefer Apache to serve static files
# and comment out the ProxyPass lines above for /makethecase (keep /api ones)
# Alias /makethecase /var/www/jsapps/makethecase/dist
# <Directory /var/www/jsapps/makethecase/dist>
#     Options -Indexes +FollowSymLinks
#     AllowOverride All
#     Require all granted
#     
#     # Fallback to index.html for client-side routing
#     RewriteEngine On
#     RewriteBase /makethecase/
#     RewriteRule ^index\.html$ - [L]
#     RewriteCond %{REQUEST_FILENAME} !-f
#     RewriteCond %{REQUEST_FILENAME} !-d
#     RewriteRule . /makethecase/index.html [L]
# </Directory>

# Security headers (optional but recommended)
Header always set X-Content-Type-Options "nosniff"
Header always set X-Frame-Options "SAMEORIGIN"
Header always set X-XSS-Protection "1; mode=block"
