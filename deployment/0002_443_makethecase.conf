# -------------------------------------------------------------------
# --- Configuration for MakeTheCase App (/makethecase)
# This file is included by services.byu.edu.conf
# -------------------------------------------------------------------



    # Enable proxy modules
    ProxyPreserveHost On
    ProxyRequests Off

    # Proxy API requests to Node.js backend
    # The backend expects /api routes, so we pass them through
    ProxyPass /makethecase/api http://localhost:3001/api
    ProxyPassReverse /makethecase/api http://localhost:3001/api

    # Serve static files directly from Apache (more efficient than proxying to Node.js)
    # IMPORTANT: This Alias must come AFTER ProxyPass directives to avoid conflicts
    Alias /makethecase /var/www/jsapps/makethecase/dist
    <Directory /var/www/jsapps/makethecase/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        # Cache static assets (JS, CSS, images) for 1 year
        <FilesMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
            Header set Cache-Control "public, max-age=31536000, immutable"
        </FilesMatch>

        # Don't cache HTML files (for updates)
        <FilesMatch "\.html$">
            Header set Cache-Control "no-cache, no-store, must-revalidate"
        </FilesMatch>

        # Enable rewrite engine for SPA routing
        RewriteEngine On
        RewriteBase /makethecase/

        # Don't rewrite if the file exists
        RewriteCond %{REQUEST_FILENAME} -f
        RewriteRule ^ - [L]

        # Don't rewrite if the directory exists
        RewriteCond %{REQUEST_FILENAME} -d
        RewriteRule ^ - [L]

        # For all other requests, serve index.html (client-side routing)
        RewriteRule ^ /makethecase/index.html [L]
    </Directory>

